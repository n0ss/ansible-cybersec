---

- hosts: all
  become: false
  tasks:

    - name: Create "git" directory if it does not exist
      tags: always, folder, dependencies
      ansible.builtin.file:
        path: /home/{{username}}/git
        state: directory
        mode: '0755'

    - name: Clone SecLists repo into git folder
      tags: offensive, wordlists, git
      ansible.builtin.git:
        repo: https://github.com/danielmiessler/SecLists
        dest: /home/{{username}}/git/SecLists

    - name: Clone John The Ripper repo into git folder
      tags: offensive, hash, git
      ansible.builtin.git:
        repo: https://github.com/openwall/john
        dest: /home/{{username}}/git/john

    - name: Install John The Ripper dependencies
      tags: always, hash, dependencies
      apt:
        name:
          - git
          - build-essential
          - libssl-dev
          - zlib1g-dev
          - yasm
          - pkg-config
          - libgmp-dev
          - libpcap-dev
          - libbz2-dev
        state: latest
      become: yes

    - name: Configure John The Ripper Makefile
      ansible.builtin.script: /home/{{username}}/git/john/src/configure
      args:
        creates: /home/{{username}}/git/john/src/Makefile

    - name: Compile John The Ripper from downloaded source
      tags: offensive, hash, make
      make:
        chdir: /home/{{username}}/git/john/src
        target: install
        params:
            NUM_THREADS: 4

    - name: Create a symbolic link to JtR binaries
      ansible.builtin.file:
        src: /home/{{username}}/git/john/run
        dest: /usr/local/bin
        owner: '{{username}}'
        group: '{{username}}'
        state: link

    - name: Clone PEASS-ng repo into git folder
      tags: offensive, escalation, git
      ansible.builtin.git:
        repo: https://github.com/carlospolop/PEASS-ng
        dest: /home/{{username}}/git/PEASS-ng

    - name: Clone hash-identifier repo into git folder
      tags: offensive, hash, git
      ansible.builtin.git:
        repo: https://github.com/blackploit/hash-identifier
        dest: /home/{{username}}/git/hash-identifier

    - name: Clone Responder repo into git folder
      tags: offensive, hash, git
      ansible.builtin.git:
        repo: https://github.com/SpiderLabs/Responder
        dest: /home/{{username}}/git/Responder

